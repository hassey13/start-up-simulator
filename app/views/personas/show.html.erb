<p>Logged in as: <%= current_user.first_name %> <%= form_tag logout_path, method: :delete do %>
      <%= submit_tag "Logout" %>
    <% end %></p>

<% if flash[:notice] %>
  <div class="flash">
    <p><%= flash[:notice] %></p>
  </div>
<% end %>

<h1>Hello <%= @persona.name %>!</h1>
<h3>Money: $<%= number_with_delimiter(current_persona.money, :delimiter => ',')%></h3>

<%= form_tag(logout_persona_path, method: 'DELETE') do %>
  <%= submit_tag 'Persona Sign out' %>
<% end %>

<br>

<%= form_tag(delete_persona_path, method: 'DELETE') do %>
  <%= submit_tag 'Delete Persona' %>
<% end %>

<br>

<h3>Products</h3>
  <% if @persona.products.count > 0 %>
    <% @persona.products.each do |product| %>
    <p><%= product.name %> - Cost: $<%= (product.sell_price)/4 %></p>
    <% end %>
  <% end %>

<%= link_to 'Create Product', new_product_path %>

<br><br>

<h3>Place Order</h3>
  <%= form_tag '/orders/new', method: :post, class: "navbar-form navbar-left search-form" do %>
    <%= label_tag 'Select Product' %>
    <br>
    <%=  select("order", "name", current_persona.products.collect {|p| p.name}, {include_blank: true}) %>
    <br><br>
    <%= label_tag 'Quantity' %>
    <br>
    <%= text_field_tag 'order[quantity]'%>
    <br><br>
    <%= label_tag 'Select Factory' %>
    <br>
    <%=  select("order", "factory", current_persona.factories.collect {|f| f.name if f.availability}.compact, {include_blank: false}) %>
    <br><br>
    <%= submit_tag 'Place order' %>

  <% end %>

<h3>Available Factories</h3>
  <%= link_to "Unlock Factories", new_factory_path %>
  <ul>
    <% @persona.factories.each do |factory| %>
        <%  if factory.availability %>
          <p><%= link_to factory.name, factory %></p>
        <% end %>
    <% end %>
  </ul>

<h3>Current Stock</h3>

  <% unless current_persona.distribution_centers.blank? %>
    <% current_persona.distribution_centers.each do |dc| %>
      <p><%= link_to "#{dc.name}", dc %></p>
      <% unless dc.product_distribution_centers.blank? %>
      <ul>
        <% dc.product_distribution_centers.each do |pdc| %>
          <li><%= "#{Product.find(pdc.product_id).name} - Qty: #{pdc.quantity}"  %></li>
        <% end %>
      </ul>
      <% else %>
        <p>You have no products in this distribution center. <%= link_to "Link", stock_product_path %> one!</p>
      <% end %>
    <% end %>

  <% else %>
    <li>You have no distribution centers. <%= link_to "Create", new_distribution_center_path %> one!</li>
  <% end %>
